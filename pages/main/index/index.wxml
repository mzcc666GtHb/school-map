<view class='main-box'>
  <view class="top-filter" wx:if="{{showNearBy}}">
    <van-dropdown-menu active-color="#07c160">
      <van-dropdown-item 
      id="distanceDropdown"
      value="{{ distance }}" 
      options="{{ option1 }}"
      bind:change="onChangeDistanceDropdown"
      bind:open="onOpenDropdown"
      bind:close="onCloseDropdown"/>
      <van-dropdown-item
      id="placeTypeDropdown" 
      value="{{ queryPlaceType }}" 
      options="{{ option2 }}"
      bind:change="onChangePlaceTypeDropdown"
      bind:open="onOpenDropdown"
      bind:close="onCloseDropdown"/>
    </van-dropdown-menu>
  </view>
  <van-overlay wx:if="{{showNearBy}}" z-index="{{998}}" show="{{ showOverlay }}" bind:click="onClickHideOverlay" />
  <!-- 地图 -->
  <map id="myMap" class="index-map" bindregionchange="regionchange" bindmarkertap="bindmarkertap" bindcallouttap="bindcallouttap" scale="{{mapScale}}" latitude="{{latitude}}" longitude="{{longitude}}" markers="{{markers}}" show-location>
    <cover-view slot="callout">
      <block wx:for="{{customCalloutMarker}}" wx:key="*this">
        <cover-view class="customCallout" marker-id="{{item.id}}">
          <cover-view style="white-space:normal;margin-top: 20px;text-align:center;width:100%;min-height:40px">{{activeName}}</cover-view>
          <cover-view style="margin-top: 4px;width:100%;text-align:center">
            {{item.count}}
          </cover-view>
        </cover-view>
      </block>
    </cover-view>
  </map>
 <image wx:if="{{showNearBy}}" class="img-map" src="../image/pin.png"></image>

  <!-- 底部搜索框 -->
  <view class="cover-view" hidden="{{!tabsShow}}" style="height: 130rpx">
    <view class="container">
       <view class="tab-input" data-type="SCHOOL" bindtap="showSearch" hover-class="common-hover" hover-stop-propagation="false">
            <van-icon name="search" size="20px" />
            请输入学校、小区
          </view>
    </view>
  </view>

  <!-- 右侧工具栏-->
  <view class="right-btns-wrap" hover-class="none" hover-stop-propagation="false">
    <view class="list-btn right-btn" wx:if="{{houses.length}}" bindtap="showHouses" hover-class="none" hover-stop-propagation="false">
      <image class="bgImg" src="../image/list.png"></image>
    </view>
    <!-- <view class="ctrl-btn right-btn" wx:if="{{true}}" bindtap="showRightPopup" hover-class="none" hover-stop-propagation="false">
      <image class="bgImg" src="../image/filter.png"></image>
    </view> -->
     <view class="ctrl-btn right-btn" wx:if="{{true}}" bindtap="showNearByPlace" hover-class="none" hover-stop-propagation="false">
      <image class="bgImg" src="../image/nearby.png"></image>
    </view>
     <view class="ctrl-btn right-btn" wx:if="{{true}}" bindtap="backToOrigin" hover-class="none" hover-stop-propagation="false">
      <image class="bgImg" src="../image/loc.png"></image>
    </view>
  </view>

  <!-- 底部弹出卡片 -->
  <van-popup
    overlay="{{false}}"
    show="{{ showPlaceCard }}"
    closeable
    close-icon-position="top-right"
    position="bottom"
    bind:close="onClosePlaceCard">
    <view class="bottom-card">
      <view class="card-img">
        <view class="{{placeInfo.hasImg ? 'place-img' : 'no-img'}}">
          <image class="card-pic" src="{{placeInfo.imgSrc}}" mode="{{ placeInfo.hasImg ? 'aspectFill' : 'center'}}" lazy-load="false"></image>
        </view>
        <view class="taking" wx:if="{{!placeInfo.hasImg}}" selectable="false" space="false" decode="false">
          收集中
        </view>
      </view>
      <view class="card-right">
        <view class="card-title">
          {{placeInfo.title}}
        </view>
        <view class="" wx:if="{{placeInfo.placeType === 2}}">
          <view class="card-price" wx:if="{{placeInfo.price}}">
          {{placeInfo.price ?placeInfo.price + '元/m²' : '' }}
        </view>
        <view class="card-price-tip" wx:else>
          房价更新中
        </view>
        </view>
        <view class="card-time">
          {{placeInfo.buildDate ? placeInfo.buildDate: ''}}
          {{placeInfo.plate ? placeInfo.plate: ''}}
        </view>
        <view class="card-tags">
          <view class="card-tag" wx:for="{{placeInfo.tags}}" wx:key="*this">
            {{item}}
          </view>
        </view>
      </view>
    </view>
  </van-popup>
</view>